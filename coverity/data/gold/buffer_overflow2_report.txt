Issue: Potential Buffer Overflow

CID: 1002
Severity: High
Type: Security
Category: Buffer Overflow
File: drivers/gpu/drm/amd/amdgpu/amdgpu_atombios.c
Function: amdgpu_atombios_copy_swap
Line: 1625


Description:
The function amdgpu_atombios_copy_swap uses fixed-size buffers src_tmp and dst_tmp of 5 u32 elements (20 bytes) each. However, it processes num_bytes of data without checking if this exceeds the buffer size. This can lead to a buffer overflow if num_bytes is greater than 20.

Explanation:

Fixed-size buffers are declared
u32 src_tmp[5], dst_tmp[5];
Data is copied into src_tmp without size checking:
memcpy(src_tmp, src, num_bytes);
or
memcpy(src_tmp, src, align_num_bytes);

Data is copied out of dst_tmp without size checking:
memcpy(dst, dst_tmp, align_num_bytes);
or
memcpy(dst, dst_tmp, num_bytes);


Potential Impact
Writing beyond the end of src_tmp can corrupt stack memory.
Reading beyond the end of dst_tmp can leak sensitive information.
In worst-case scenarios, this vulnerability could be exploited for arbitrary code execution.

Recommended Fix

1. Use dynamically allocated buffers instead of fixed-size arrays
2. Alternatively, if dynamic allocation is not possible, add a size check